<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Gig - Talent-Hub Pro</title>
  <meta name="description" content="View detailed information about freelancer gigs on Talent-Hub Pro — packages, gallery, reviews, seller info and secure ordering.">
  <meta name="keywords" content="freelancer gigs, hire freelancer, gig details, talent hub, buy services, packages, reviews">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">  <style>
    :root {
      --bg1: #07102a;
      --bg2: #040718;
      --ink: #e9f2ff;
      --muted: #98abc7;
      --glass: rgba(255, 255, 255, .03);
      --b: rgba(255, 255, 255, .06);
      --brand: #34d399;
      --brand-ink: #042819;
      --warn: #ffcc66;
      --err: #ff8a8a;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      color: var(--ink);
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }

    .glass {
      background: var(--glass);
      backdrop-filter: blur(8px);
      border: 1px solid var(--b);
      border-radius: 12px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .btn-brand { background: var(--brand); color: var(--brand-ink); }
    .btn-outline { background: transparent; border: 2px solid var(--brand); color: var(--brand); }

    .preview-cover { aspect-ratio: 16/9; background: #12102b center/cover no-repeat; border-radius: 12px; border: 1px solid rgba(255,255,255,.06); }

    .chip { display:inline-flex; align-items:center; gap:6px; padding:6px 12px; border-radius:999px; background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.05); margin:4px; font-size:12px; }

    .plan-column { background: rgba(255,255,255,.02); border-radius:12px; padding:20px; border:1px solid rgba(255,255,255,.04); display:flex; flex-direction:column; transition:all .3s ease; height:100%; }
    .plan-column.popular { border:2px solid rgba(52,211,153,0.4); position:relative; overflow:hidden; }
    .plan-column.popular::before { content:'MOST POPULAR'; position:absolute; top:0; right:0; background:var(--brand); color:var(--brand-ink); font-size:10px; font-weight:800; padding:4px 10px; border-bottom-left-radius:8px; }

    .plan-content { flex:1; display:flex; flex-direction:column; gap:12px; }

    .soft { background: rgba(255,255,255,.01); border-radius:8px; padding:12px; border:1px dashed rgba(255,255,255,.03); }

    .kicker { font-size:1.25rem; font-weight:800; margin-bottom:1rem; color:var(--brand); display:flex; align-items:center; gap:10px; }

    .tab-button { padding:10px 20px; border-radius:8px; cursor:pointer; transition:all .2s ease; background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.05); }
    .tab-button.active { background: rgba(52,211,153,0.1); border-color: rgba(52,211,153,0.3); color:var(--brand); }

    .gallery-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(180px,1fr)); gap:12px; margin-top:15px; }

    .gallery-item { border-radius:8px; overflow:hidden; aspect-ratio:4/3; background:rgba(255,255,255,.02); border:1px solid rgba(255,255,255,.05); transition:all .3s ease; cursor:pointer; display:flex; align-items:center; justify-content:center; }
    .gallery-item img { width:100%; height:100%; object-fit:cover; }

    .feature-list { list-style:none; padding:0; }
    .feature-list li { padding:8px 0; border-bottom:1px solid rgba(255,255,255,.05); display:flex; align-items:center; gap:10px; }

    .review-card { background: rgba(255,255,255,0.02); border-radius:10px; padding:16px; border:1px solid rgba(255,255,255,0.05); margin-bottom:15px; }

    .animate-pulse { animation: pulse 2s cubic-bezier(0.4,0,0.6,1) infinite; }
    @keyframes pulse { 0%,100%{ opacity:1 } 50%{ opacity:0.5 } }

    .prose p { margin:0 0 1rem 0; }

    /* small utility for text wrapping & pre-line handling */
    .pre-wrap { white-space: pre-line; word-wrap: break-word; }

    /* Loading overlay styles */
    #loadingOverlay { position:fixed; inset:0; background:linear-gradient(90deg, rgba(0,0,0,0.6), rgba(0,0,0,0.8)); display:flex; align-items:center; justify-content:center; z-index:60; }
    .spinner { width:64px; height:64px; border-radius:50%; border:6px solid rgba(255,255,255,0.08); border-top-color:var(--brand); animation:spin 1s linear infinite; }
    @keyframes spin { to{ transform:rotate(360deg); } }

    @media (max-width: 768px) { .gallery-grid { grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); } }
  </style></head>
<body class="min-h-screen">
  <!-- NAV -->
  <nav class="glass sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="index.html" class="text-2xl font-extrabold text-emerald-400 flex items-center gap-2">
        <i class="fas fa-rocket"></i> Talent-Hub
      </a>
      <div class="flex items-center gap-3">
        <span id="loginStatus" class="text-sm px-3 py-1 rounded-full bg-black/20">Checking auth…</span>
        <a id="loginBtnLink" href="login.html" class="btn btn-outline">Login</a>
        <button id="btnLogout" class="btn hidden">Logout</button>
      </div>
    </div>
  </nav>  <!-- Loading Overlay -->  <div id="loadingOverlay">
    <div class="text-center">
      <div class="spinner mx-auto"></div>
      <p class="mt-4 text-lg font-semibold">Loading gig details...</p>
    </div>
  </div>  <main class="max-w-6xl mx-auto px-4 py-6 grid lg:grid-cols-3 gap-6">
    <!-- LEFT: Gig Details -->
    <section class="lg:col-span-2 space-y-6">
      <!-- Breadcrumb -->
      <div class="flex items-center text-sm text-muted">
        <a href="index.html" class="hover:text-brand transition-colors">Home</a>
        <i class="fas fa-chevron-right mx-2 text-xs"></i>
        <a href="browse.html" class="hover:text-brand transition-colors">Browse Gigs</a>
        <i class="fas fa-chevron-right mx-2 text-xs"></i>
        <span id="breadcrumbCategory">Category</span>
        <i class="fas fa-chevron-right mx-2 text-xs"></i>
        <span class="text-ink">Gig Details</span>
      </div><!-- Service Title & Seller Info -->
  <div class="glass p-6">
    <h1 id="gigTitle" class="text-2xl md:text-3xl font-extrabold">Loading gig title...</h1>
    <div class="flex items-center gap-3 mt-4">
      <img id="sellerPhoto" class="w-10 h-10 rounded-full object-cover" src="https://via.placeholder.com/80" alt="Seller profile photo">
      <div>
        <div id="sellerName" class="font-bold">Seller Name</div>
        <div class="flex items-center gap-2 text-sm">
          <div id="starContainer" class="flex items-center text-yellow-300" aria-hidden="true">★★★★★</div>
          <span id="rating" class="ml-2">5.0</span>
          <span>(<span id="reviewsCount">0</span> reviews)</span>
        </div>
      </div>
    </div>
    <div class="mt-4 flex flex-wrap gap-3">
      <div class="chip"><i class="fas fa-check-circle"></i> Top Rated</div>
      <div class="chip"><i class="fas fa-bolt"></i> Fast Delivery</div>
      <div class="chip"><i class="fas fa-repeat"></i> Unlimited Revisions</div>
    </div>
  </div>

  <!-- Gallery Section -->
  <div class="glass p-5">
    <div class="kicker">
      <i class="fas fa-images"></i>
      <span>Gallery</span>
    </div>
    <div id="galleryContainer" class="gallery-grid">
      <div class="gallery-item animate-pulse bg-muted/20"></div>
      <div class="gallery-item animate-pulse bg-muted/20"></div>
      <div class="gallery-item animate-pulse bg-muted/20"></div>
    </div>
  </div>

  <!-- Tabs Navigation -->
  <div class="flex gap-2 overflow-x-auto pb-2">
    <div class="tab-button active" data-tab="description">
      <i class="fas fa-file-alt mr-2"></i>Description
    </div>
    <div class="tab-button" data-tab="packages">
      <i class="fas fa-cubes mr-2"></i>Packages
    </div>
    <div class="tab-button" data-tab="reviews">
      <i class="fas fa-star mr-2"></i>Reviews
    </div>
    <div class="tab-button" data-tab="faq">
      <i class="fas fa-question-circle mr-2"></i>FAQ
    </div>
  </div>

  <!-- Tab Content -->
  <div class="tab-content">
    <!-- Description Tab -->
    <div id="tab-description" class="tab-pane active">
      <div class="glass p-5">
        <div class="kicker">
          <i class="fas fa-info-circle"></i>
          <span>Service Description</span>
        </div>
        <div id="gigDescription" class="prose prose-invert max-w-none pre-wrap">
          <p>Loading description...</p>
        </div>

        <div class="mt-6">
          <div class="text-sm font-semibold mb-3">What's Included:</div>
          <ul class="feature-list" id="featuresList">
            <li><i class="fas fa-check-circle"></i> High-quality design files</li>
            <li><i class="fas fa-check-circle"></i> Source files</li>
            <li><i class="fas fa-check-circle"></i> Fast delivery</li>
            <li><i class="fas fa-check-circle"></i> Unlimited revisions</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Packages Tab -->
    <div id="tab-packages" class="tab-pane hidden">
      <div class="glass p-5">
        <div class="kicker">
          <i class="fas fa-cubes"></i>
          <span>Packages & Pricing</span>
        </div>
        <div class="grid md:grid-cols-3 gap-5 mt-4" id="packagesContainer">
          <!-- Packages will be loaded here -->
        </div>
      </div>
    </div>

    <!-- Reviews Tab -->
    <div id="tab-reviews" class="tab-pane hidden">
      <div class="glass p-5">
        <div class="kicker">
          <i class="fas fa-star"></i>
          <span>Reviews & Ratings</span>
        </div>
        <div class="grid md:grid-cols-3 gap-6 mt-4">
          <div class="text-center p-4 glass">
            <div id="avgRatingLarge" class="text-5xl font-bold text-brand">4.8</div>
            <div id="avgStarsSmall" class="flex justify-center my-3"></div>
            <div class="text-muted text-sm">Based on <span id="totalReviews">0</span> reviews</div>
          </div>
          <div class="md:col-span-2">
            <div class="space-y-2" id="ratingBars">
              <!-- Rating bars will be injected here -->
            </div>
          </div>
        </div>

        <div id="reviewsContainer" class="mt-6">
          <!-- Reviews will be loaded here -->
        </div>
      </div>
    </div>

    <!-- FAQ Tab -->
    <div id="tab-faq" class="tab-pane hidden">
      <div class="glass p-5">
        <div class="kicker">
          <i class="fas fa-question-circle"></i>
          <span>Frequently Asked Questions</span>
        </div>
        <div id="faqContainer" class="mt-4 space-y-4">
          <!-- FAQ items will be loaded here -->
        </div>
      </div>
    </div>
  </div>
</section>

<!-- RIGHT: Seller Info & Action -->
<aside class="space-y-4">
  <!-- Seller Contact Box -->
  <div class="glass p-5">
    <div class="flex items-center gap-3">
      <img id="sidebarSellerPhoto" class="w-14 h-14 rounded-full object-cover" src="https://via.placeholder.com/80" alt="Seller profile photo">
      <div>
        <div id="sidebarSellerName" class="font-bold">Seller Name</div>
        <div class="flex items-center text-sm text-green-400">
          <span class="w-2 h-2 bg-green-400 rounded-full mr-2"></span>
          <span id="onlineStatus">Online</span>
        </div>
      </div>
    </div>
    
    <div class="mt-4 text-sm">
      <div class="text-slate-300">Avg. response time:</div>
      <div id="responseTime" class="font-semibold">Within a few hours</div>
    </div>
    
    <button id="contactSellerBtn" class="btn btn-brand w-full mt-4 justify-center">
      <i class="fas fa-envelope"></i> Contact Me
    </button>

    <button id="favoriteBtn" class="btn btn-outline w-full mt-3 justify-center">
      <i class="far fa-heart"></i> Add to Favorites
    </button>
  </div>

  <!-- Gig Action Box -->
  <div class="glass p-5">
    <div class="text-lg font-bold mb-3">Get Started</div>
    
    <div class="flex items-center justify-between mb-4">
      <span class="text-slate-300">Starting at:</span>
      <span id="startingPrice" class="text-2xl font-black text-brand">₹---</span>
    </div>
    
    <div class="text-sm text-slate-300 mb-4">
      <i class="fas fa-clock mr-2"></i>
      <span id="deliveryTime">Delivery in -- days</span>
    </div>
    
    <button id="orderNowBtn" class="btn btn-brand w-full justify-center py-3 text-lg">
      <i class="fas fa-shopping-cart"></i> Order Now
    </button>
    
    <div class="text-center text-xs text-slate-400 mt-3">
      <i class="fas fa-lock mr-1"></i> Secure payment
    </div>
  </div>

  <!-- Seller Statistics -->
  <div class="glass p-5">
    <div class="text-xs text-slate-300 mb-3 uppercase tracking-wide">Seller Information</div>
    
    <div class="space-y-3 text-sm">
      <div>
        <div class="text-slate-300 flex items-center">
          <i class="fas fa-map-marker-alt mr-2 w-4"></i> From
        </div>
        <div id="sellerCountry" class="font-semibold mt-1">--</div>
      </div>
      
      <div>
        <div class="text-slate-300 flex items-center">
          <i class="fas fa-calendar-alt mr-2 w-4"></i> Member since
        </div>
        <div id="memberSince" class="font-semibold mt-1">--</div>
      </div>
      
      <div>
        <div class="text-slate-300 flex items-center">
          <i class="fas fa-shipping-fast mr-2 w-4"></i> Last delivery
        </div>
        <div id="lastDelivery" class="font-semibold mt-1">--</div>
      </div>
      
      <div>
        <div class="text-slate-300 flex items-center">
          <i class="fas fa-language mr-2 w-4"></i> Languages
        </div>
        <div id="languagesSpoken" class="font-semibold mt-1">--</div>
      </div>
    </div>
  </div>

  <!-- Gig Metadata -->
  <div class="glass p-5">
    <div class="text-xs text-slate-300 mb-3 uppercase tracking-wide">Gig Details</div>
    
    <div class="space-y-3 text-sm">
      <div>
        <div class="text-slate-300 flex items-center">
          <i class="fas fa-tag mr-2 w-4"></i> Category
        </div>
        <div id="gigCategory" class="font-semibold mt-1">--</div>
      </div>
      
      <div>
        <div class="text-slate-300 flex items-center">
          <i class="fas fa-hashtag mr-2 w-4"></i> Tags
        </div>
        <div id="gigTags" class="flex flex-wrap gap-1 mt-2">
          <!-- Tags will be loaded here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Share Gig -->
  <div class="glass p-5">
    <div class="text-xs text-slate-300 mb-3 uppercase tracking-wide">Share This Gig</div>
    <div class="flex justify-between">
      <a href="#" class="text-muted hover:text-blue-400 transition-colors" aria-label="Share on Facebook">
        <i class="fab fa-facebook-f text-lg"></i>
      </a>
      <a href="#" class="text-muted hover:text-blue-400 transition-colors" aria-label="Share on Twitter">
        <i class="fab fa-twitter text-lg"></i>
      </a>
      <a href="#" class="text-muted hover:text-red-500 transition-colors" aria-label="Share on Pinterest">
        <i class="fab fa-pinterest-p text-lg"></i>
      </a>
      <a href="#" class="text-muted hover:text-blue-700 transition-colors" aria-label="Share on LinkedIn">
        <i class="fab fa-linkedin-in text-lg"></i>
      </a>
      <a href="#" class="text-muted hover:text-green-500 transition-colors" aria-label="Share on WhatsApp">
        <i class="fab fa-whatsapp text-lg"></i>
      </a>
    </div>
  </div>
</aside>

  </main>  <footer class="text-center py-6 text-slate-300">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="text-2xl font-extrabold text-emerald-400 mb-4 md:mb-0">Talent-Hub</div>
        <div class="flex gap-6 text-sm">
          <a href="#" class="hover:text-brand transition-colors">Terms of Service</a>
          <a href="#" class="hover:text-brand transition-colors">Privacy Policy</a>
          <a href="#" class="hover:text-brand transition-colors">Contact Us</a>
        </div>
      </div>
      <div class="mt-4 text-xs text-slate-400">© 2025 Talent-Hub Pro. All rights reserved.</div>
    </div>
  </footer>  <!-- Firebase App (the core Firebase SDK) -->  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, query, where, getDocs, updateDoc, arrayUnion, arrayRemove, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // Firebase config (kept same as provided)
    const firebaseConfig = {
      apiKey: "AIzaSyBxNGIBexYUb-LecKJRgxPNsY5ZFN1_zUA",
      authDomain: "skillspot-pro.firebaseapp.com",
      projectId: "skillspot-pro",
      storageBucket: "skillspot-pro.appspot.com",
      messagingSenderId: "600467343030",
      appId: "1:600467343030:web:ad985d8e95b3ea99c64817",
      measurementId: "G-TYL2XF4WZY"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM elements
    const loginStatus = document.getElementById('loginStatus');
    const loginBtnLink = document.getElementById('loginBtnLink');
    const btnLogout = document.getElementById('btnLogout');
    const contactSellerBtn = document.getElementById('contactSellerBtn');
    const favoriteBtn = document.getElementById('favoriteBtn');
    const orderNowBtn = document.getElementById('orderNowBtn');
    const loadingOverlay = document.getElementById('loadingOverlay');

    // Gig data elements (many already defined above in markup)
    const gigTitle = document.getElementById('gigTitle');
    const sellerPhoto = document.getElementById('sellerPhoto');
    const sidebarSellerPhoto = document.getElementById('sidebarSellerPhoto');
    const sellerName = document.getElementById('sellerName');
    const sidebarSellerName = document.getElementById('sidebarSellerName');
    const rating = document.getElementById('rating');
    const reviewsCount = document.getElementById('reviewsCount');
    const gigDescription = document.getElementById('gigDescription');
    const featuresList = document.getElementById('featuresList');
    const packagesContainer = document.getElementById('packagesContainer');
    const faqContainer = document.getElementById('faqContainer');
    const responseTime = document.getElementById('responseTime');
    const sellerCountry = document.getElementById('sellerCountry');
    const memberSince = document.getElementById('memberSince');
    const lastDelivery = document.getElementById('lastDelivery');
    const languagesSpoken = document.getElementById('languagesSpoken');
    const gigCategory = document.getElementById('gigCategory');
    const gigTags = document.getElementById('gigTags');
    const startingPrice = document.getElementById('startingPrice');
    const deliveryTime = document.getElementById('deliveryTime');
    const galleryContainer = document.getElementById('galleryContainer');
    const breadcrumbCategory = document.getElementById('breadcrumbCategory');
    const totalReviews = document.getElementById('totalReviews');
    const fiveStarReviews = document.getElementById('fiveStarReviews');
    const fourStarReviews = document.getElementById('fourStarReviews');
    const threeStarReviews = document.getElementById('threeStarReviews');
    const twoStarReviews = document.getElementById('twoStarReviews');
    const oneStarReviews = document.getElementById('oneStarReviews');
    const reviewsContainer = document.getElementById('reviewsContainer');
    const starContainer = document.getElementById('starContainer');
    const avgRatingLarge = document.getElementById('avgRatingLarge');
    const avgStarsSmall = document.getElementById('avgStarsSmall');
    const ratingBars = document.getElementById('ratingBars');

    // Tab elements
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanes = document.querySelectorAll('.tab-pane');

    // Get gig ID from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const gigId = urlParams.get('id');

    // Current user and gig data
    let currentUser = null;
    let gigData = null;
    let isFavorite = false;

    // Auth state handler
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        loginStatus.textContent = 'Not logged in';
        loginBtnLink.classList.remove('hidden');
        btnLogout.classList.add('hidden');
        currentUser = null;
        return;
      }
      currentUser = user;
      loginStatus.textContent = `Hi, ${user.displayName || user.email.split('@')[0]}`;
      loginBtnLink.classList.add('hidden');
      btnLogout.classList.remove('hidden');

      // Check favorite state if gig loaded
      if (gigId && gigData) await checkIfFavorite();
    });

    // Logout handler
    btnLogout.addEventListener('click', async () => {
      try {
        await signOut(auth);
        window.location.href = 'index.html';
      } catch (e) {
        alert('Logout failed');
      }
    });

    // Tab switching
    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        const tabId = button.getAttribute('data-tab');
        tabButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        tabPanes.forEach(pane => pane.classList.add('hidden'));
        document.getElementById(`tab-${tabId}`).classList.remove('hidden');
      });
    });

    // Contact seller button handler
    contactSellerBtn.addEventListener('click', () => {
      if (!auth.currentUser) {
        alert('Please login to contact the seller');
        window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.href);
        return;
      }
      showContactModal();
    });

    // Favorite button handler
    favoriteBtn.addEventListener('click', async () => {
      if (!auth.currentUser) {
        alert('Please login to add favorites');
        window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.href);
        return;
      }
      try {
        const userRef = doc(db, "users", currentUser.uid);
        if (isFavorite) {
          await updateDoc(userRef, { favorites: arrayRemove(gigId) });
          favoriteBtn.innerHTML = '<i class="far fa-heart"></i> Add to Favorites';
          isFavorite = false;
        } else {
          await updateDoc(userRef, { favorites: arrayUnion(gigId) });
          favoriteBtn.innerHTML = '<i class="fas fa-heart"></i> Remove Favorite';
          isFavorite = true;
        }
      } catch (error) {
        console.error("Error updating favorites:", error);
        alert('Error updating favorites');
      }
    });

    // Order now handler
    orderNowBtn.addEventListener('click', () => {
      if (!auth.currentUser) {
        alert('Please login to place an order');
        window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.href);
        return;
      }
      window.location.href = `order.html?gigId=${gigId}`;
    });

    // Check if gig is favorite for the current user
    async function checkIfFavorite() {
      if (!currentUser || !gigId) return;
      try {
        const userDoc = await getDoc(doc(db, "users", currentUser.uid));
        if (userDoc.exists()) {
          const userData = userDoc.data();
          isFavorite = userData.favorites && userData.favorites.includes(gigId);
          if (isFavorite) favoriteBtn.innerHTML = '<i class="fas fa-heart"></i> Remove Favorite';
        }
      } catch (error) { console.error(error); }
    }

    // Show contact modal
    function showContactModal() {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4';
      modal.innerHTML = `
        <div class="glass p-6 rounded-xl max-w-md w-full">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold">Contact Seller</h3>
            <button class="text-muted hover:text-ink" id="closeModal">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="space-y-4">
            <div>
              <label class="block text-sm mb-1">Subject</label>
              <input id="contactSubject" type="text" class="w-full p-3 rounded-lg bg-black/20 border border-muted/30 focus:border-brand focus:outline-none" placeholder="Question about your gig">
            </div>
            <div>
              <label class="block text-sm mb-1">Message</label>
              <textarea id="contactMessage" class="w-full p-3 rounded-lg bg-black/20 border border-muted/30 focus:border-brand focus:outline-none h-32" placeholder="Type your message here..."></textarea></div>
        <button id="sendContactBtn" class="btn btn-brand w-full">Send Message</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
  modal.querySelector('#closeModal').addEventListener('click', () => document.body.removeChild(modal));
  modal.addEventListener('click', (e) => { if (e.target === modal) document.body.removeChild(modal); });

  modal.querySelector('#sendContactBtn').addEventListener('click', async () => {
    const subject = modal.querySelector('#contactSubject').value.trim();
    const message = modal.querySelector('#contactMessage').value.trim();
    if (!subject || !message) { alert('Please enter subject and message'); return; }
    // Here you would send the message to seller (via Firestore collection or email). We'll show a placeholder.
    alert('Message sent to seller');
    document.body.removeChild(modal);
  });
}

// Load gig data
async function loadGigData() {
  if (!gigId) {
    alert('No gig ID specified');
    window.location.href = 'index.html';
    return;
  }

  try {
    const gigDocRef = doc(db, "subho_gigs", gigId);
    const gigDocSnap = await getDoc(gigDocRef);

    if (!gigDocSnap.exists()) {
      alert('Gig not found');
      window.location.href = 'index.html';
      return;
    }

    gigData = gigDocSnap.data();
    populateGigData(gigData);

    // Fetch seller data if createdByUid present
    if (gigData.createdByUid) {
      try {
        const sellersQuery = query(collection(db, "sellers"), where("uid", "==", gigData.createdByUid));
        const sellerSnapshot = await getDocs(sellersQuery);
        if (!sellerSnapshot.empty) {
          const sellerData = sellerSnapshot.docs[0].data();
          populateSellerData(sellerData);
        }
      } catch (error) { console.error("Error fetching seller data:", error); }
    }

    // Fetch reviews collection if exists (optional)
    try {
      const reviewsQuery = query(collection(db, "reviews"), where('gigId','==',gigId), orderBy('createdAt','desc'), limit(50));
      const reviewsSnap = await getDocs(reviewsQuery);
      const reviews = [];
      reviewsSnap.forEach(d => reviews.push({ id: d.id, ...d.data() }));
      renderReviews(reviews);
    } catch (err) { /* it's optional, ignore if no collection */ }

    // If user is logged in, check favorites
    if (auth.currentUser) await checkIfFavorite();

    // Hide loading
    loadingOverlay.classList.add('hidden');
  } catch (error) {
    console.error("Error loading gig:", error);
    alert('Error loading gig details');
    loadingOverlay.classList.add('hidden');
  }
}

// Populate gig data into the UI
function populateGigData(gigData) {
  // Basic info
  gigTitle.textContent = gigData.title || 'Untitled Gig';
  // Use safe innerText/HTML depending on content — allow basic HTML but avoid scripts
  gigDescription.innerHTML = gigData.description || 'No description provided';
  gigDescription.classList.add('pre-wrap');

  // Seller info
  const sellerNameText = gigData.sellerName || 'Unknown Seller';
  sellerName.textContent = sellerNameText;
  sidebarSellerName.textContent = sellerNameText;

  if (gigData.sellerPhoto) {
    sellerPhoto.src = gigData.sellerPhoto;
    sidebarSellerPhoto.src = gigData.sellerPhoto;
    sellerPhoto.alt = `${sellerNameText} profile photo`;
    sidebarSellerPhoto.alt = `${sellerNameText} profile photo`;
  }

  // Ratings and orders
  const avgRating = (typeof gigData.rating === 'number') ? gigData.rating : (gigData.reviewsAvg ? gigData.reviewsAvg : 0);
  const reviewsCountNum = gigData.reviewsCount || gigData.reviews || 0;
  rating.textContent = (avgRating).toFixed(1);
  reviewsCount.textContent = reviewsCountNum;
  avgRatingLarge.textContent = (avgRating).toFixed(1);
  totalReviews.textContent = reviewsCountNum;

  // Draw stars (graphical)
  renderStars(avgRating);
  renderSmallStars(avgRating);

  // Category and tags
  gigCategory.textContent = gigData.category || 'Uncategorized';
  breadcrumbCategory.textContent = gigData.category || 'Category';

  if (gigData.tags && gigData.tags.length > 0) {
    gigTags.innerHTML = '';
    gigData.tags.forEach(tag => {
      const tagElement = document.createElement('span');
      tagElement.className = 'chip';
      tagElement.textContent = tag;
      gigTags.appendChild(tagElement);
    });
  }

  // Starting price and delivery
  if (gigData.plans && gigData.plans.length > 0) {
    const basicPlan = gigData.plans[0];
    startingPrice.textContent = `₹${basicPlan.price || '0'}`;
    deliveryTime.textContent = `Delivery in ${basicPlan.delivery || 'N/A'} days`;
  }

  // Packages
  packagesContainer.innerHTML = '';
  if (gigData.plans && gigData.plans.length > 0) {
    gigData.plans.forEach((plan, index) => {
      const isPopular = index === 1; // keep original behavior
      const planElement = document.createElement('div');
      planElement.className = `plan-column ${isPopular ? 'popular' : ''}`;
      planElement.innerHTML = `
        <div class="plan-content">
          <div class="text-center">
            <h3 class="font-bold text-lg">${escapeHtml(plan.name || `Package ${index + 1}`)}</h3>
            <div class="text-2xl font-black text-emerald-300 my-2">₹${plan.price || '0'}</div>
            <p class="text-sm text-slate-300">${escapeHtml(plan.description || '')}</p>
          </div>
          <div class="mt-4 grid grid-cols-2 gap-2 text-sm">
            <div>
              <div class="text-slate-300">Delivery</div>
              <div class="font-semibold">${plan.delivery || 'N/A'} days</div>
            </div>
            <div>
              <div class="text-slate-300">Revisions</div>
              <div class="font-semibold">${plan.revisions || 'N/A'}</div>
            </div>
          </div>
          ${plan.extras && plan.extras.length > 0 ? `
            <div class="mt-4">
              <div class="text-slate-300 text-sm mb-2">Includes:</div>
              <ul class="text-sm space-y-2">
                ${plan.extras.filter(extra => extra.state === 'included').map(extra => 
                  `<li class="flex items-center"><i class="fas fa-check text-emerald-400 mr-2"></i>${escapeHtml(extra.label)}</li>`
                ).join('')}
              </ul>
            </div>
          ` : ''}
        </div>
        <button class="btn btn-brand mt-4 justify-center select-package" data-plan="${index}">
          Select Package
        </button>
      `;
      packagesContainer.appendChild(planElement);
    });

    // Add event listeners to package selection buttons
    document.querySelectorAll('.select-package').forEach(button => {
      button.addEventListener('click', () => {
        if (!auth.currentUser) { alert('Please login to purchase this gig'); window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.href); return; }
        const planIndex = button.getAttribute('data-plan');
        window.location.href = `order.html?gigId=${gigId}&plan=${planIndex}`;
      });
    });
  }

  // Features list (from first plan)
  featuresList.innerHTML = '';
  if (gigData.plans?.[0]?.extras) {
    gigData.plans[0].extras.filter(e => e.state === 'included').forEach(extra => {
      const li = document.createElement('li');
      li.innerHTML = `<i class="fas fa-check-circle text-emerald-400"></i> ${escapeHtml(extra.label)}`;
      featuresList.appendChild(li);
    });
  }

  // FAQ
  faqContainer.innerHTML = '';
  if (gigData.faq && gigData.faq.length > 0) {
    gigData.faq.forEach(faqItem => {
      const faqElement = document.createElement('div');
      faqElement.className = 'soft';
      faqElement.innerHTML = `
        <div class="font-semibold">${escapeHtml(faqItem.q || 'Question not available')}</div>
        <div class="mt-2 text-slate-300">${escapeHtml(faqItem.a || 'Answer not available')}</div>
      `;
      faqContainer.appendChild(faqElement);
    });
  }

  // Gallery
  galleryContainer.innerHTML = '';
  if (gigData.media && gigData.media.length > 0) {
    gigData.media.forEach((mediaUrl, index) => {
      const mediaElement = document.createElement('div');
      mediaElement.className = 'gallery-item';
      const img = document.createElement('img');
      img.src = mediaUrl;
      img.alt = `${gigData.title || 'Gig'} image ${index + 1}`;
      mediaElement.appendChild(img);
      mediaElement.addEventListener('click', () => showLightbox(mediaUrl));
      galleryContainer.appendChild(mediaElement);
    });
  }

  // Set page title and meta description for SEO
  document.title = `${gigData.title} - Talent-Hub Pro`;
  let metaDescription = document.querySelector('meta[name="description"]');
  if (!metaDescription) { metaDescription = document.createElement('meta'); metaDescription.name = 'description'; document.head.appendChild(metaDescription); }
  const plainTextDescription = gigDescription.textContent || gigDescription.innerText || '';
  metaDescription.content = plainTextDescription.substring(0,160);
}

// Render star graphics (5-star with halves)
function renderStars(avg) {
  const max = 5;
  const rounded = Math.round(avg * 2) / 2; // nearest 0.5
  let html = '';
  for (let i=1;i<=max;i++) {
    if (i <= Math.floor(rounded)) html += '<i class="fas fa-star"></i>';
    else if (i - 0.5 === rounded) html += '<i class="fas fa-star-half-alt"></i>';
    else html += '<i class="far fa-star"></i>';
  }
  starContainer.innerHTML = html;
  starContainer.setAttribute('aria-label', `Rating ${avg.toFixed(1)} out of 5`);
}

function renderSmallStars(avg) {
  avgStarsSmall.innerHTML = '';
  const max = 5;
  const rounded = Math.round(avg * 2) / 2;
  for (let i=1;i<=max;i++) {
    const elt = document.createElement('i');
    if (i <= Math.floor(rounded)) elt.className = 'fas fa-star text-yellow-400';
    else if (i - 0.5 === rounded) elt.className = 'fas fa-star-half-alt text-yellow-400';
    else elt.className = 'far fa-star text-yellow-400';
    avgStarsSmall.appendChild(elt);
  }
}

// Render reviews (if any)
function renderReviews(reviews) {
  // reviews: array of {rating, text, author, createdAt}
  reviewsContainer.innerHTML = '';
  if (!reviews || reviews.length === 0) {
    reviewsContainer.innerHTML = '<div class="text-slate-400">No reviews yet.</div>';
    // Also set rating distribution to zero
    renderRatingDistribution([]);
    return;
  }

  // Compute distribution
  const dist = {5:0,4:0,3:0,2:0,1:0};
  let sum = 0;
  reviews.forEach(r => { const rr = Number(r.rating) || 0; if (rr>=1 && rr<=5) dist[Math.round(rr)]++; sum += rr; });
  const avg = (sum / reviews.length) || 0;
  avgRatingLarge.textContent = avg.toFixed(1);
  rating.textContent = avg.toFixed(1);
  totalReviews.textContent = reviews.length;
  reviewsCount.textContent = reviews.length;
  renderStars(avg);
  renderSmallStars(avg);
  renderRatingDistribution(dist);

  // Render each review card
  reviews.forEach(r => {
    const rc = document.createElement('div');
    rc.className = 'review-card';
    const created = r.createdAt && r.createdAt.toDate ? r.createdAt.toDate().toLocaleDateString() : (r.createdAt ? new Date(r.createdAt).toLocaleDateString() : '');
    rc.innerHTML = `
      <div class="flex items-start gap-3">
        <div class="w-12 h-12 rounded-full bg-slate-800 flex items-center justify-center text-xl">${(r.authorName||'U').charAt(0).toUpperCase()}</div>
        <div class="flex-1">
          <div class="flex items-center justify-between">
            <div class="font-semibold">${escapeHtml(r.authorName || 'Anonymous')}</div>
            <div class="text-sm text-slate-400">${created}</div>
          </div>
          <div class="text-sm text-yellow-400 mt-1">${renderInlineStars(r.rating)}</div>
          <div class="mt-2 text-slate-300">${escapeHtml(r.text || '')}</div>
        </div>
      </div>
    `;
    reviewsContainer.appendChild(rc);
  });
}

// Render rating distribution bars
function renderRatingDistribution(dist) {
  ratingBars.innerHTML = '';
  const total = Object.values(dist).reduce((a,b)=>a+b,0) || 0;
  for (let i=5;i>=1;i--) {
    const count = dist[i] || 0;
    const pct = total ? Math.round((count/total)*100) : 0;
    const row = document.createElement('div');
    row.className = 'flex items-center justify-between text-sm mb-1';
    row.innerHTML = `
      <div class="flex items-center"><span>${i}</span><i class="fas fa-star text-yellow-400 ml-1 text-xs"></i></div>
      <div class="w-3/4 bg-muted/20 rounded-full h-2 mx-3"><div class="bg-yellow-400 h-2 rounded-full" style="width:${pct}%"></div></div>
      <div>${count}</div>
    `;
    ratingBars.appendChild(row);
  }
}

// Return small inline stars HTML for a rating number
function renderInlineStars(ratingNum) {
  const num = Number(ratingNum) || 0; const rounded = Math.round(num*2)/2; let s = '';
  for (let i=1;i<=5;i++) {
    if (i <= Math.floor(rounded)) s += '<i class="fas fa-star"></i>';
    else if (i - 0.5 === rounded) s += '<i class="fas fa-star-half-alt"></i>';
    else s += '<i class="far fa-star"></i>';
  }
  return s;
}

// Lightbox
function showLightbox(imageUrl) {
  const lightbox = document.createElement('div');
  lightbox.className = 'fixed inset-0 bg-black/90 flex items-center justify-center z-50';
  lightbox.innerHTML = `
    <div class="relative max-w-4xl w-full mx-4">
      <button class="absolute -top-12 right-0 text-white text-2xl">
        <i class="fas fa-times"></i>
      </button>
      <img src="${imageUrl}" class="w-full h-auto rounded-lg" alt="Gig image">
    </div>
  `;
  document.body.appendChild(lightbox);
  lightbox.addEventListener('click', (e) => { if (e.target === lightbox || e.target.closest('button')) document.body.removeChild(lightbox); });
}

// Populate seller data
function populateSellerData(sellerData) {
  if (!sellerData) return;
  if (sellerData.responseTime) responseTime.textContent = sellerData.responseTime;
  if (sellerData.country) sellerCountry.textContent = sellerData.country;
  if (sellerData.memberSince) memberSince.textContent = (sellerData.memberSince.seconds ? new Date(sellerData.memberSince.seconds * 1000).toLocaleDateString() : new Date(sellerData.memberSince).toLocaleDateString());
  if (sellerData.lastDelivery) lastDelivery.textContent = sellerData.lastDelivery;
  if (sellerData.languages) languagesSpoken.textContent = Array.isArray(sellerData.languages) ? sellerData.languages.join(', ') : sellerData.languages;
}

// Escape HTML helper (tiny)
function escapeHtml(unsafe) {
  if (!unsafe && unsafe !== 0) return '';
  return String(unsafe)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/\'/g, '&#039;');
}

// Initialize page
window.addEventListener('DOMContentLoaded', () => {
  loadGigData();
});

  </script>
</body>
</html>
