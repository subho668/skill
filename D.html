<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gig Details — Talent-Hub</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <style>
    :root {
      --bg: #071018; 
      --panel: #0b1720; 
      --muted: #9fb0bd; 
      --accent1: #06d6a0; 
      --accent2: #3b82f6;
      --accent3: #f59e0b;
      --card: linear-gradient(180deg,#071a12,#071827);
      --card-hover: linear-gradient(180deg, #082a1e, #082232);
      --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      min-height: 100vh;
      background: linear-gradient(180deg, #050b10, #071018);
      color: #e6f8f1;
      font-family: 'Poppins', system-ui, Segoe UI, Roboto, Arial;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .brand {
      font-weight: 800;
      color: var(--accent1);
      font-size: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .brand i {
      font-size: 26px;
    }
    
    .card {
      background: var(--panel);
      border-radius: 16px;
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.04);
      box-shadow: 0 12px 30px rgba(4, 8, 12, 0.6);
      transition: var(--transition);
    }
    
    .card:hover {
      border-color: rgba(6, 214, 160, 0.1);
      box-shadow: 0 15px 35px rgba(4, 18, 25, 0.7);
    }
    
    .top {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 24px;
      margin-bottom: 30px;
    }
    
    @media (max-width: 1080px) {
      .top {
        grid-template-columns: 1fr;
      }
      
      .side-card {
        position: static !important;
        margin-top: 20px;
      }
    }
    
    .gallery {
      display: flex;
      flex-direction: column;
      gap: 12px;
      position: relative;
    }
    
    .main-image {
      height: 420px;
      border-radius: 12px;
      background-size: cover;
      background-position: center;
      box-shadow: 0 12px 34px rgba(3, 8, 12, 0.6);
      cursor: zoom-in;
      transition: var(--transition);
    }
    
    .main-image:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(3, 8, 12, 0.7);
    }
    
    .thumbs {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .thumb {
      width: 80px;
      height: 80px;
      border-radius: 10px;
      background-size: cover;
      background-position: center;
      border: 2px solid transparent;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .thumb:hover {
      transform: scale(1.05);
      border-color: var(--accent1);
    }
    
    .thumb.active {
      border-color: var(--accent1);
      box-shadow: 0 0 0 3px rgba(6, 214, 160, 0.2);
    }
    
    .title {
      font-size: 28px;
      font-weight: 800;
      color: #fff;
      margin-bottom: 10px;
      line-height: 1.3;
    }
    
    .seller-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .seller-avatar {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      font-weight: 800;
      color: white;
      background: linear-gradient(135deg, #0ea5a0, #2563eb);
      font-size: 20px;
      flex-shrink: 0;
    }
    
    .muted {
      color: var(--muted);
    }
    
    .price-box {
      margin-top: 15px;
      padding: 16px;
      border-radius: 12px;
      background: linear-gradient(180deg, #04221a, #052a20);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid rgba(6, 214, 160, 0.1);
    }
    
    .price {
      font-weight: 900;
      font-size: 24px;
      color: var(--accent2);
    }
    
    .delivery {
      font-size: 14px;
      color: var(--muted);
    }
    
    .desc {
      margin-top: 15px;
      color: #cfeee6;
      line-height: 1.7;
      font-size: 16px;
    }
    
    .features {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 15px;
    }
    
    .chip {
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.04);
      color: var(--muted);
      font-weight: 600;
      font-size: 14px;
      border: 1px solid rgba(255, 255, 255, 0.03);
      transition: var(--transition);
    }
    
    .chip:hover {
      background: rgba(6, 214, 160, 0.1);
      color: var(--accent1);
    }
    
    .side-card {
      position: sticky;
      top: 90px;
      height: fit-content;
    }
    
    .side-price {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }
    
    .side-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 12px 18px;
      border-radius: 12px;
      border: 0;
      cursor: pointer;
      font-weight: 700;
      font-size: 16px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-ghost {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: #d8efe6;
    }
    
    .btn-ghost:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.12);
    }
    
    .btn-primary {
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      color: #042617;
      flex: 1;
      justify-content: center;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(6, 214, 160, 0.3);
    }
    
    .fav {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      background: transparent;
      border: 1px dashed rgba(255, 255, 255, 0.08);
      display: grid;
      place-items: center;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .fav:hover {
      border-color: var(--accent1);
      background: rgba(6, 214, 160, 0.05);
      color: var(--accent1);
    }
    
    .top-like-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.5);
      display: grid;
      place-items: center;
      color: #fff;
      border: 0;
      cursor: pointer;
      transition: var(--transition);
      z-index: 2;
    }
    
    .top-like-btn:hover {
      background: rgba(0, 0, 0, 0.6);
      transform: scale(1.05);
    }
    
    .top-like-btn.liked {
      background: linear-gradient(90deg, #10b981, #2dd4bf);
      color: #042617;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
      padding-bottom: 12px;
    }
    
    .tab {
      padding: 10px 16px;
      border-radius: 10px;
      font-weight: 600;
      color: var(--muted);
      cursor: pointer;
      transition: var(--transition);
    }
    
    .tab:hover {
      background: rgba(255, 255, 255, 0.03);
      color: #cfeee6;
    }
    
    .tab.active {
      background: rgba(6, 182, 212, 0.1);
      color: #cfeee6;
    }
    
    .review {
      display: flex;
      gap: 15px;
      padding: 16px;
      border-radius: 12px;
      background: #071a18;
      border: 1px solid rgba(255, 255, 255, 0.03);
      margin-bottom: 12px;
      transition: var(--transition);
    }
    
    .review:hover {
      background: #08201e;
      border-color: rgba(6, 214, 160, 0.1);
    }
    
    .similar-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .small {
      font-size: 13px;
      color: var(--muted);
    }
    
    footer {
      margin-top: 30px;
      text-align: center;
      color: var(--muted);
      font-size: 14px;
      padding: 20px 0;
      border-top: 1px solid rgba(255, 255, 255, 0.04);
    }
    
    /* New styles for enhancements */
    .verified-badge {
      background: var(--accent2);
      color: white;
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 4px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-left: 8px;
    }
    
    .rating-stars {
      color: #f59e0b;
      margin-right: 5px;
    }
    
    .packages {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 20px;
    }
    
    @media (max-width: 768px) {
      .packages {
        grid-template-columns: 1fr;
      }
    }
    
    .package {
      background: linear-gradient(180deg, #0a1e24, #071a22);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.04);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }
    
    .package:hover {
      transform: translateY(-5px);
      border-color: rgba(6, 214, 160, 0.15);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }
    
    .package.popular {
      border: 2px solid var(--accent1);
      transform: scale(1.02);
    }
    
    .package.popular::before {
      content: 'MOST POPULAR';
      position: absolute;
      top: 0;
      right: 0;
      background: var(--accent1);
      color: #042617;
      font-size: 10px;
      font-weight: 800;
      padding: 4px 10px;
      border-bottom-left-radius: 8px;
    }
    
    .package-header {
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .package-name {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 5px;
    }
    
    .package-price {
      font-size: 24px;
      font-weight: 800;
      color: var(--accent1);
      margin: 10px 0;
    }
    
    .package-desc {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 15px;
    }
    
    .package-features {
      list-style: none;
      margin-bottom: 20px;
    }
    
    .package-features li {
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    
    .package-features li i {
      color: var(--accent1);
    }
    
    .package-btn {
      width: 100%;
      text-align: center;
      justify-content: center;
    }
    
    .lightbox {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(7, 16, 24, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    
    .lightbox.active {
      opacity: 1;
      pointer-events: all;
    }
    
    .lightbox-content {
      max-width: 90%;
      max-height: 90%;
      position: relative;
    }
    
    .lightbox-img {
      max-width: 100%;
      max-height: 90vh;
      border-radius: 8px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
    }
    
    .lightbox-close {
      position: absolute;
      top: -40px;
      right: 0;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: none;
      font-size: 18px;
    }
    
    .lightbox-nav {
      position: absolute;
      top: 50%;
      width: 100%;
      display: flex;
      justify-content: space-between;
      transform: translateY(-50%);
      padding: 0 20px;
    }
    
    .lightbox-btn {
      background: rgba(0, 0, 0, 0.5);
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: none;
      font-size: 20px;
      transition: var(--transition);
    }
    
    .lightbox-btn:hover {
      background: rgba(0, 0, 0, 0.7);
      transform: scale(1.1);
    }
    
    .faq-item {
      margin-bottom: 15px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      overflow: hidden;
    }
    
    .faq-question {
      padding: 16px;
      background: rgba(255, 255, 255, 0.02);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      transition: var(--transition);
    }
    
    .faq-question:hover {
      background: rgba(255, 255, 255, 0.04);
    }
    
    .faq-answer {
      padding: 0 16px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease, padding 0.3s ease;
      background: rgba(255, 255, 255, 0.01);
    }
    
    .faq-item.active .faq-answer {
      max-height: 300px;
      padding: 16px;
    }
    
    .faq-item.active .faq-toggle i {
      transform: rotate(180deg);
    }
    
    .faq-toggle {
      transition: var(--transition);
    }
    
    .hidden {
      display: none;
    }
    
    .floating-order {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--panel);
      padding: 15px 0;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.2);
      display: none;
      z-index: 999;
    }
    
    .floating-order-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    @media (max-width: 768px) {
      .floating-order-content {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
      }
      
      .floating-order-actions {
        width: 100%;
        display: flex;
        gap: 10px;
      }
      
      .floating-order-actions .btn {
        flex: 1;
      }
    }
    
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--accent1);
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 12px 20px;
      background: var(--panel);
      color: white;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 1000;
      transform: translateY(100px);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    
    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .toast.success {
      border-left: 4px solid var(--accent1);
    }
    
    .toast.error {
      border-left: 4px solid #ef4444;
    }
    
    .review-form {
      margin-top: 20px;
      padding: 20px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.03);
    }
    
    .star-rating {
      display: flex;
      gap: 5px;
      margin-bottom: 15px;
    }
    
    .star {
      font-size: 24px;
      color: #4b5563;
      cursor: pointer;
      transition: color 0.2s ease;
    }
    
    .star.active {
      color: #f59e0b;
    }
    
    .stats {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .stat-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 15px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.03);
    }
    
    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: rgba(6, 214, 160, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent1);
      font-size: 18px;
    }
    
    .mobile-order-bar {
      display: none;
    }
    
    @media (max-width: 768px) {
      .mobile-order-bar {
        display: flex;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: var(--panel);
        padding: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        z-index: 999;
        justify-content: space-between;
        align-items: center;
      }
      
      .side-card {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <i class="fas fa-rocket"></i>
        Talent-Hub
      </div>
      <div id="loginStatus" class="small">Checking auth…</div>
    </header>

    <main id="content">
      <div class="top">
        <!-- LEFT: gig details -->
        <section class="card">
          <div style="display:flex;gap:20px;align-items:flex-start;flex-wrap:wrap">
            <div class="gallery" style="flex:1">
              <div id="mainImage" class="main-image" style="background-image:url('https://via.placeholder.com/1200x800?text=Loading...')"></div>
              <div class="thumbs" id="thumbs"></div>
              <button class="top-like-btn" id="topLikeBtn">
                <i class="far fa-heart"></i>
              </button>
            </div>

            <div style="flex-basis:340px">
              <h1 class="title" id="gigTitle">Loading title…</h1>

              <div class="seller-row" style="margin-bottom:12px">
                <div id="sellerAvatar" class="seller-avatar">U</div>
                <div>
                  <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
                    <div id="sellerName" style="font-weight:800">Seller</div>
                    <span class="verified-badge">Verified <i class="fas fa-check"></i></span>
                    <div id="sellerSince" class="small muted"></div>
                  </div>
                  <div class="small muted" id="sellerBio">—</div>
                </div>
              </div>

              <div class="stats">
                <div class="stat-item">
                  <div class="stat-icon">
                    <i class="fas fa-star"></i>
                  </div>
                  <div>
                    <div style="font-weight:700">4.8</div>
                    <div class="small">Rating</div>
                  </div>
                </div>
                
                <div class="stat-item">
                  <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                  </div>
                  <div>
                    <div style="font-weight:700" id="ordersCount">42</div>
                    <div class="small">Orders</div>
                  </div>
                </div>
                
                <div class="stat-item">
                  <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                  </div>
                  <div>
                    <div style="font-weight:700" id="deliveryTime">3</div>
                    <div class="small">Days</div>
                  </div>
                </div>
              </div>

              <div class="price-box">
                <div>
                  <div class="small muted">Starting at</div>
                  <div class="price" id="price">₹0</div>
                </div>
                <div class="delivery small muted" id="delivery">3 days delivery</div>
              </div>

              <div class="desc" id="gigDesc">Loading description…</div>

              <div class="features" id="features"></div>

              <!-- Packages Section -->
              <div class="packages" id="packages">
                <!-- Packages will be loaded dynamically -->
              </div>

              <div class="tabs" style="margin-top:24px">
                <div class="tab active" data-tab="details">Details</div>
                <div class="tab" data-tab="reviews">Reviews (24)</div>
                <div class="tab" data-tab="faq">FAQ</div>
                <div class="tab" data-tab="similar">Related</div>
              </div>

              <div class="tab-content" id="tabContent" style="margin-top:20px">
                <div id="detailsTab">
                  <h4 style="margin-top:10px;color:#bfead5">What you'll get</h4>
                  <div class="small muted" id="whatYouGet">Loading…</div>

                  <h4 style="margin-top:16px;color:#bfead5">Skills</h4>
                  <div id="skillsWrap" style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px"></div>
                </div>

                <div id="reviewsTab" class="hidden">
                  <div id="reviewsList" style="margin-top:12px"></div>

                  <div class="review-form">
                    <div style="font-weight:800;margin-bottom:12px">Leave a review</div>
                    <div class="star-rating" id="starRating">
                      <span class="star" data-value="1">☆</span>
                      <span class="star" data-value="2">☆</span>
                      <span class="star" data-value="3">☆</span>
                      <span class="star" data-value="4">☆</span>
                      <span class="star" data-value="5">☆</span>
                    </div>
                    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
                      <input id="reviewText" placeholder="Share your experience..." style="flex:1;padding:12px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.05);color:#e8fff4" />
                      <button id="addReviewBtn" class="btn btn-primary">Post Review</button>
                    </div>
                    <div id="reviewStatus" class="small muted" style="margin-top:12px"></div>
                  </div>
                </div>
                
                <div id="faqTab" class="hidden">
                  <div class="faq-list" id="faqList">
                    <!-- FAQ items will be loaded dynamically -->
                  </div>
                </div>

                <div id="similarTab" class="hidden">
                  <div id="similarGrid" class="similar-grid"></div>
                </div>
              </div>
            </div>
          </div>

          <div style="margin-top:24px">
            <h3 style="margin-bottom:12px;color:#bfead5">Full Description</h3>
            <div id="longDesc" class="muted">Loading...</div>
          </div>
        </section>

        <!-- RIGHT: CTA + seller profile -->
        <aside class="card side-card">
          <div class="side-price">
            <div>
              <div class="small muted">Price</div>
              <div class="price" id="sidePrice">₹0</div>
            </div>
            <div class="small muted" id="sideDelivery">Delivery: 3 days</div>
          </div>

          <div class="side-actions" id="sideActions">
            <button id="continueBtn" class="btn btn-primary">
              <i class="fas fa-shopping-cart"></i> Continue (Hire)
            </button>
            <button id="favBtn" class="fav" title="Like this gig">
              <i id="favIcon" class="fa-regular fa-heart"></i>
            </button>
          </div>

          <div style="margin-top:20px;padding:16px;border-radius:12px;background:linear-gradient(180deg,#041518,#052a1e);border:1px solid rgba(255,255,255,0.03)">
            <div style="display:flex;gap:12px;align-items:center">
              <img id="sellerPhoto" src="" alt="photo" style="width:60px;height:60px;border-radius:12px;object-fit:cover;background:#063a2c"/>
              <div>
                <div id="panelSellerName" style="font-weight:800">Seller</div>
                <div id="panelSellerRole" class="small muted">—</div>
              </div>
            </div>

            <div style="margin-top:12px">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div class="small muted">Response time</div>
                <div style="font-weight:800">Within 24 hours</div>
              </div>
              <div style="display:flex;gap:10px;align-items:center;margin-top:12px">
                <button id="contactBtn" class="btn btn-ghost" style="padding:10px 12px">
                  <i class="fas fa-envelope"></i> Contact Seller
                </button>
                <a id="sellerProfileLink" href="#" class="small muted" style="text-decoration:underline">View profile</a>
              </div>
            </div>
            <div id="statusMsg" class="small muted" style="margin-top:12px"></div>
          </div>
        </aside>
      </div>

      <!-- Floating order bar for mobile -->
      <div class="mobile-order-bar">
        <div>
          <div class="small muted">Starting at</div>
          <div class="price" style="font-size:20px">₹0</div>
        </div>
        <button class="btn btn-primary" style="padding:10px 16px">
          <i class="fas fa-shopping-cart"></i> Order Now
        </button>
      </div>

      <footer>© 2025 Talent-Hub — Live from Firestore</footer>
    </main>
  </div>

  <!-- Lightbox for images -->
  <div class="lightbox" id="lightbox">
    <div class="lightbox-content">
      <img class="lightbox-img" id="lightboxImg" src="" alt="">
      <button class="lightbox-close" id="lightboxClose">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="lightbox-nav">
      <button class="lightbox-btn" id="lightboxPrev">
        <i class="fas fa-chevron-left"></i>
      </button>
      <button class="lightbox-btn" id="lightboxNext">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>

  <!-- Toast notification -->
  <div class="toast" id="toast">
    <i class="fas fa-check-circle"></i>
    <div id="toastMessage">Operation completed successfully</div>
  </div>

  <!-- FIREBASE (modular v10) -->
  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore, doc, collection, query, where, orderBy, limit,
      onSnapshot, getDoc, getDocs, addDoc, serverTimestamp, runTransaction, setDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Your firebase config (use your project values)
    const firebaseConfig = {
      apiKey: "AIzaSyBxNGIBexYUb-LecKJRgxPNsY5ZFN1_zUA",
      authDomain: "skillspot-pro.firebaseapp.com",
      projectId: "skillspot-pro",
      storageBucket: "skillspot-pro.appspot.com",
      messagingSenderId: "600467343030",
      appId: "1:600467343030:web:ad985d8e95b3ea99c64817"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // helpers
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));
    const GIG_ID = new URL(location).searchParams.get('id');
    if (!GIG_ID) {
      document.getElementById('content').innerHTML = '<div class="card">Open this page with ?id=GIG_ID</div>';
      throw new Error('Missing id');
    }

    // Elements
    const mainImage = $('#mainImage'), thumbs = $('#thumbs');
    const gigTitle = $('#gigTitle'), gigDesc = $('#gigDesc'), longDesc = $('#longDesc');
    const priceEl = $('#price'), sidePrice = $('#sidePrice'), deliveryEl = $('#delivery'), sideDelivery = $('#sideDelivery');
    const featuresWrap = $('#features'), skillsWrap = $('#skillsWrap'), whatYouGet = $('#whatYouGet');
    const sellerAvatar = $('#sellerAvatar'), sellerName = $('#sellerName'), sellerBio = $('#sellerBio'), sellerSince = $('#sellerSince');
    const sellerPhoto = $('#sellerPhoto'), panelSellerName = $('#panelSellerName'), sellerProfileLink = $('#sellerProfileLink'), panelSellerRole = $('#panelSellerRole');
    const likeArea = $('#likeArea'), favBtn = $('#favBtn'), favIcon = $('#favIcon'), topLikeBtn = $('#topLikeBtn');
    const continueBtn = $('#continueBtn'), contactBtn = $('#contactBtn'), loginStatus = $('#loginStatus'), statusMsg = $('#statusMsg');
    const reviewsList = $('#reviewsList'), addReviewBtn = $('#addReviewBtn'), reviewText = $('#reviewText'), reviewStatus = $('#reviewStatus'), starSelect = $('#starSelect');
    const similarGrid = $('#similarGrid');
    const packagesContainer = $('#packages');
    const faqList = $('#faqList');
    const lightbox = $('#lightbox');
    const lightboxImg = $('#lightboxImg');
    const lightboxClose = $('#lightboxClose');
    const lightboxPrev = $('#lightboxPrev');
    const lightboxNext = $('#lightboxNext');
    const toast = $('#toast');
    const toastMessage = $('#toastMessage');
    const starRating = $('#starRating');
    const stars = $$('.star');

    // constants for collections
    const GIGS_COL = 'subho_gigs';
    const USERS_COL = 'users';
    const GIG_LIKES_USER = 'gig_likes_user';
    const GIG_LIKES_AGG = 'gig_likes_agg';
    const GIG_LIKES_RAW = 'gig_likes';
    const REVIEWS_COL = 'gig_reviews';

    // state
    let currentUser = null;
    let gigData = null;
    let currentImages = [];
    let currentImageIndex = 0;
    let aggUnsub = null;
    let reviewsUnsub = null;
    let similarUnsub = null;
    let sellerUnsub = null;
    let selectedRating = 5;

    // util
    const escapeImg = u => String(u||'').replaceAll("'", "%27");
    
    function setGallery(urls=[]) {
      if (!Array.isArray(urls) || urls.length===0) urls = ['https://via.placeholder.com/1200x800.png?text=Talent-Hub+Gig'];
      currentImages = urls;
      mainImage.style.backgroundImage = `url('${escapeImg(urls[0])}')`;
      thumbs.innerHTML = '';
      urls.forEach((u,i)=>{
        const t = document.createElement('div'); 
        t.className = 'thumb' + (i===0?' active':''); 
        t.style.backgroundImage = `url('${escapeImg(u)}')`;
        t.dataset.index = i;
        t.addEventListener('click', ()=>{
          $$(`.thumb`).forEach(x=>x.classList.remove('active')); 
          t.classList.add('active'); 
          mainImage.style.backgroundImage = `url('${escapeImg(u)}')`;
          currentImageIndex = i;
        });
        thumbs.appendChild(t);
      });
    }

    // Lightbox functionality
    mainImage.addEventListener('click', () => {
      lightbox.classList.add('active');
      lightboxImg.src = currentImages[currentImageIndex];
    });
    
    lightboxClose.addEventListener('click', () => {
      lightbox.classList.remove('active');
    });
    
    lightboxPrev.addEventListener('click', () => {
      currentImageIndex = currentImageIndex > 0 ? currentImageIndex - 1 : currentImages.length - 1;
      lightboxImg.src = currentImages[currentImageIndex];
    });
    
    lightboxNext.addEventListener('click', () => {
      currentImageIndex = currentImageIndex < currentImages.length - 1 ? currentImageIndex + 1 : 0;
      lightboxImg.src = currentImages[currentImageIndex];
    });
    
    // Star rating functionality
    stars.forEach(star => {
      star.addEventListener('click', () => {
        const value = parseInt(star.dataset.value);
        selectedRating = value;
        
        stars.forEach(s => {
          const starValue = parseInt(s.dataset.value);
          if (starValue <= value) {
            s.textContent = '★';
            s.classList.add('active');
          } else {
            s.textContent = '☆';
            s.classList.remove('active');
          }
        });
      });
      
      // Set initial rating to 5 stars
      if (parseInt(star.dataset.value) <= 5) {
        star.textContent = '★';
        star.classList.add('active');
      }
    });

    // Show toast notification
    function showToast(message, type = 'success') {
      toastMessage.textContent = message;
      toast.className = `toast ${type}`;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Load packages
    function loadPackages() {
      const packages = [
        {
          name: 'Basic Package',
          price: 1999,
          delivery: '3 days',
          description: 'Perfect for getting started with essential features',
          features: [
            '1 initial concept',
            '2 revisions',
            'Source files',
            'Basic support'
          ]
        },
        {
          name: 'Standard Package',
          price: 3999,
          delivery: '5 days',
          description: 'Our most popular package with enhanced features',
          features: [
            '2 initial concepts',
            '4 revisions',
            'Source files',
            'Priority support',
            '3D mockup',
            'Social media kit'
          ],
          popular: true
        },
        {
          name: 'Premium Package',
          price: 6999,
          delivery: '7 days',
          description: 'Complete solution with premium features',
          features: [
            '3 initial concepts',
            'Unlimited revisions',
            'Source files',
            '24/7 premium support',
            '3D mockup',
            'Social media kit',
            'Print-ready files',
            'Brand guidelines'
          ]
        }
      ];
      
      packagesContainer.innerHTML = '';
      
      packages.forEach(pkg => {
        const packageEl = document.createElement('div');
        packageEl.className = `package ${pkg.popular ? 'popular' : ''}`;
        
        packageEl.innerHTML = `
          <div class="package-header">
            <div class="package-name">${pkg.name}</div>
            <div class="package-desc">${pkg.description}</div>
          </div>
          <div class="package-price">₹${pkg.price}</div>
          <ul class="package-features">
            ${pkg.features.map(feature => `<li><i class="fas fa-check"></i> ${feature}</li>`).join('')}
          </ul>
          <button class="btn btn-primary package-btn">Select Package</button>
        `;
        
        packagesContainer.appendChild(packageEl);
      });
    }
    
    // Load FAQ
    function loadFAQ() {
      const faqs = [
        {
          question: 'How long does it take to complete a project?',
          answer: 'The delivery time depends on the package you choose. Basic package takes 3 days, Standard takes 5 days, and Premium takes 7 days. Rush delivery is available for an additional fee.'
        },
        {
          question: 'What do I need to provide to get started?',
          answer: 'To get started, please provide your company name, industry, target audience, preferred colors (if any), and any examples of designs you like. The more information you provide, the better we can meet your expectations.'
        },
        {
          question: 'How many revisions do I get?',
          answer: 'The number of revisions depends on your package. Basic includes 2 revisions, Standard includes 4 revisions, and Premium includes unlimited revisions until you are completely satisfied.'
        },
        {
          question: 'What file formats will I receive?',
          answer: 'You will receive all source files (AI, PSD, etc.) as well as web-ready formats (JPG, PNG, PDF). If you need specific formats, please let us know.'
        },
        {
          question: 'Do you offer refunds?',
          answer: 'Yes, we offer a 100% satisfaction guarantee. If you are not happy with the initial concepts, we will refund your money. However, once you have approved a concept and requested revisions, the refund policy no longer applies.'
        }
      ];
      
      faqList.innerHTML = '';
      
      faqs.forEach((faq, index) => {
        const faqItem = document.createElement('div');
        faqItem.className = 'faq-item';
        faqItem.innerHTML = `
          <div class="faq-question">
            ${faq.question}
            <span class="faq-toggle"><i class="fas fa-chevron-down"></i></span>
          </div>
          <div class="faq-answer">
            ${faq.answer}
          </div>
        `;
        
        faqItem.addEventListener('click', () => {
          faqItem.classList.toggle('active');
        });
        
        faqList.appendChild(faqItem);
      });
    }
    
    // Floating order bar
    function initFloatingOrderBar() {
      window.addEventListener('scroll', () => {
        const sideCard = $('.side-card');
        const sideCardRect = sideCard.getBoundingClientRect();
        const floatingOrder = $('.floating-order');
        
        if (sideCardRect.top < 80) {
          floatingOrder.style.display = 'block';
        } else {
          floatingOrder.style.display = 'none';
        }
      });
    }

    // subscribe gig doc realtime
    const gigRef = doc(db, GIGS_COL, GIG_ID);
    onSnapshot(gigRef, snap => {
      if (!snap.exists()) {
        gigTitle.textContent = 'Gig not found';
        gigDesc.textContent = '';
        return;
      }
      gigData = snap.data();
      renderGig(gigData);
      watchLikes(GIG_ID);
      subscribeReviews();
      loadRelatedGigs(gigData.category);
      subscribeSeller(gigData.createdByUid || gigData.sellerId || gigData.createdByUid);
      
      // Load additional features
      loadPackages();
      loadFAQ();
      initFloatingOrderBar();
    }, err => {
      console.error('gig snapshot err', err);
      statusMsg.textContent = 'Could not load gig: ' + (err.message || err);
    });

    function renderGig(g) {
      gigTitle.textContent = g.title || 'Untitled';
      gigDesc.textContent = g.description || g.short || '';
      longDesc.textContent = g.longDescription || g.description || '';
      priceEl.textContent = '₹' + (g.price || 0);
      sidePrice.textContent = '₹' + (g.price || 0);
      deliveryEl.textContent = g.delivery ? g.delivery + ' days delivery' : (g.delivery || '3 days delivery');
      sideDelivery.textContent = 'Delivery: ' + (g.delivery || '3 days');
      whatYouGet.textContent = g.whatYouGet || 'Print-ready files, multiple concepts.';
      // features
      featuresWrap.innerHTML = ''; (g.features || g.styles || []).forEach(f=>{
        const d = document.createElement('div'); d.className='chip'; d.textContent = f; featuresWrap.appendChild(d);
      });
      // skills
      skillsWrap.innerHTML = ''; (g.skills||[]).forEach(s=>{
        const sp = document.createElement('div'); sp.className='chip'; sp.textContent = s; skillsWrap.appendChild(sp);
      });
      createdAt = g.createdAt ? (g.createdAt.toDate ? g.createdAt.toDate().toLocaleDateString() : new Date(g.createdAt).toLocaleDateString()) : '';
      $('#createdAt').textContent = createdAt ? 'Posted ' + createdAt : '';
      sellerName.textContent = g.sellerName || g.seller || 'Seller';
      sellerBio.textContent = g.sellerBio || '';
      sellerSince.textContent = g.sellerSince ? '• Since ' + g.sellerSince : '';
      // gallery
      const images = Array.isArray(g.images) && g.images.length ? g.images : (g.coverURL ? [g.coverURL] : []);
      setGallery(images);
    }

    // -------------------- Likes --------------------
    const aggDocRef = (gid) => doc(db, GIG_LIKES_AGG, gid);
    const userLikeDoc = (uid, gid) => doc(db, GIG_LIKES_USER, `${uid}_${gid}`);
    const rawLikeDoc = (uid, gid) => doc(db, GIG_LIKES_RAW, `${gid}_${uid}`);

    function watchLikes(gid) {
      // unsubscribe previous if any
      if (aggUnsub) aggUnsub();
      const aRef = aggDocRef(gid);
      aggUnsub = onSnapshot(aRef, s=>{
        const c = s.exists() ? (s.data().count||0) : 0;
        likeArea.textContent = `${c} Like${c===1?'':'s'}`;
      }, err=>{ console.warn('agg watch err', err); });

      // update user like button appearance
      refreshUserLikeState();
    }

    async function refreshUserLikeState() {
      if (!currentUser) { 
        favBtn.classList.remove('liked'); 
        favIcon.className='fa-regular fa-heart';
        topLikeBtn.innerHTML = '<i class="far fa-heart"></i>';
        return; 
      }
      try {
        const s = await getDoc(userLikeDoc(currentUser.uid, GIG_ID));
        if (s.exists()) { 
          favBtn.classList.add('liked'); 
          favIcon.className='fa-solid fa-heart';
          topLikeBtn.innerHTML = '<i class="fas fa-heart"></i>';
          topLikeBtn.classList.add('liked');
        } else { 
          favBtn.classList.remove('liked'); 
          favIcon.className='fa-regular fa-heart';
          topLikeBtn.innerHTML = '<i class="far fa-heart"></i>';
          topLikeBtn.classList.remove('liked');
        }
      } catch(e){ console.warn(e); }
    }

    const handleLike = async (e)=>{
      if (e) e.stopPropagation();
      if (!currentUser) { if (confirm('Login required to like. Go to login?')) window.location = 'login.html'; return; }
      favBtn.disabled = true;
      try {
        await runTransaction(db, async (t)=>{
          const uRef = userLikeDoc(currentUser.uid, GIG_ID);
          const rRef = rawLikeDoc(currentUser.uid, GIG_ID);
          const aRef = aggDocRef(GIG_ID);
          const uSnap = await t.get(uRef);
          const aSnap = await t.get(aRef);
          let count = aSnap.exists() ? (aSnap.data().count||0) : 0;
          if (uSnap.exists()) {
            // unlike
            t.delete(uRef);
            t.delete(rRef);
            count = Math.max(0, count - 1);
            t.set(aRef, { count }, { merge:true });
            showToast('Removed from your favorites');
          } else {
            // like
            t.set(uRef, { uid: currentUser.uid, gid: GIG_ID, createdAt: serverTimestamp() });
            t.set(rRef, { uid: currentUser.uid, gid: GIG_ID, createdAt: serverTimestamp() });
            count = count + 1;
            t.set(aRef, { count }, { merge:true });
            showToast('Added to your favorites');
          }
        });
        // UI will refresh on snapshot and refreshUserLikeState
      } catch(err){ 
        console.error('like tx err', err); 
        showToast('Could not toggle like: '+(err.message||err), 'error');
      }
      finally { favBtn.disabled = false; await refreshUserLikeState(); }
    };

    favBtn.addEventListener('click', handleLike);
    topLikeBtn.addEventListener('click', handleLike);

    // -------------------- Reviews --------------------
    function subscribeReviews() {
      // cleanup old listener
      if (reviewsUnsub) reviewsUnsub();
      const colRef = collection(db, REVIEWS_COL);
      const q = query(colRef, where('gid','==', GIG_ID), orderBy('createdAt','desc'), limit(50));
      reviewsUnsub = onSnapshot(q, snap=>{
        reviewsList.innerHTML = '';
        if (snap.empty) { reviewsList.innerHTML = '<div class="muted">No reviews yet</div>'; return; }
        snap.forEach(d=>{
          const r = d.data();
          const el = document.createElement('div'); el.className='review';
          el.innerHTML = `<div style="width:44px;height:44px;border-radius:10px;background:#072a23;display:grid;place-items:center;font-weight:800">${(r.authorName||'U')[0]||'U'}</div>
            <div style="flex:1">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div style="font-weight:800">${r.authorName||'User'}</div>
                <div class="small muted">${r.createdAt? (new Date(r.createdAt.seconds*1000).toLocaleDateString()):''}</div>
              </div>
              <div class="small muted" style="margin-top:6px"><span class="rating-stars">${'★'.repeat(r.stars || 0)}${'☆'.repeat(5 - (r.stars || 0))}</span> — ${r.text || ''}</div>
            </div>`;
          reviewsList.appendChild(el);
        });
      }, err => { console.warn('reviews listen err', err); });
    }

    addReviewBtn.addEventListener('click', async ()=>{
      reviewStatus.textContent = '';
      if (!currentUser) { if (confirm('Login required to post review. Go to login?')) window.location='login.html'; return; }
      const text = reviewText.value.trim();
      const stars = selectedRating;
      if (!text) { reviewStatus.textContent = 'Write something first'; return; }
      addReviewBtn.disabled = true;
      addReviewBtn.innerHTML = '<div class="loading-spinner"></div>';
      try {
        await addDoc(collection(db, REVIEWS_COL), {
          gid: GIG_ID,
          authorId: currentUser.uid,
          authorName: currentUser.displayName || currentUser.email || 'User',
          text,
          stars,
          createdAt: serverTimestamp()
        });
        reviewStatus.textContent = 'Posted ✓';
        reviewText.value = '';
        showToast('Review posted successfully');
      } catch (err) {
        console.error('post review err', err);
        reviewStatus.textContent = 'Could not post: ' + (err.message||err);
        showToast('Could not post review: ' + (err.message||err), 'error');
      } finally { 
        addReviewBtn.disabled = false; 
        addReviewBtn.innerHTML = 'Post Review';
      }
    });

    // -------------------- Related gigs --------------------
    function loadRelatedGigs(category) {
      // cleanup previous
      if (similarUnsub) similarUnsub();
      similarGrid.innerHTML = '';
      if (!category) { similarGrid.innerHTML = '<div class="muted">No related gigs</div>'; return; }
      const colRef = collection(db, GIGS_COL);
      const q = query(colRef, where('category','==', category), orderBy('createdAt','desc'), limit(6));

      similarUnsub = onSnapshot(q, snap=>{
        similarGrid.innerHTML = '';
        if (snap.empty) { similarGrid.innerHTML = '<div class="muted">No related gigs</div>'; return; }
        snap.forEach(d=>{
          if (d.id === GIG_ID) return; // skip current
          const g = d.data();
          const card = document.createElement('a');
          card.href = `gig-details.html?id=${d.id}`;
          card.className = 'card';
          card.style.padding='12px'; card.style.display='block'; card.style.textDecoration='none'; card.style.color='inherit';
          card.style.transition = 'var(--transition)';
          card.style.height = '100%';
          card.addEventListener('mouseenter', () => {
            card.style.transform = 'translateY(-5px)';
          });
          card.addEventListener('mouseleave', () => {
            card.style.transform = 'translateY(0)';
          });
          const img = (Array.isArray(g.images) && g.images[0]) || g.coverURL || 'https://via.placeholder.com/600x400?text=No+Image';
          card.innerHTML = `<div style="height:140px;border-radius:8px;background-image:url(${escapeImg(img)});background-size:cover;background-position:center"></div>
            <div style="margin-top:12px">
              <div style="font-weight:800;font-size:16px;margin-bottom:8px">${g.title||'Untitled'}</div>
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div class="small muted">From ₹${g.price||0}</div>
                <div class="small rating-stars">${'★'.repeat(4)}☆</div>
              </div>
            </div>`;
          similarGrid.appendChild(card);
        });
      }, err => { console.warn('related listen err', err); similarGrid.innerHTML = '<div class="muted">Could not load related gigs</div>'; });
    }

    // -------------------- Seller profile --------------------
    function subscribeSeller(uid) {
      if (!uid) return;
      if (sellerUnsub) sellerUnsub();
      const uRef = doc(db, USERS_COL, uid);
      sellerUnsub = onSnapshot(uRef, s=>{
        if (!s.exists()) {
          // fallback to data present in gig
          panelSellerName.textContent = gigData?.sellerName || 'Seller';
          panelSellerRole.textContent = gigData?.sellerRole || '';
          sellerPhoto.src = gigData?.sellerPhoto || '';
          sellerName.textContent = gigData?.sellerName || 'Seller';
          sellerBio.textContent = gigData?.sellerBio || '';
          sellerSince.textContent = gigData?.sellerSince ? '• Since ' + gigData.sellerSince : '';
          return;
        }
        const u = s.data();
        panelSellerName.textContent = u.fullName || u.displayName || (u.company || 'Seller');
        panelSellerRole.textContent = u.title || u.role || '';
        sellerPhoto.src = u.photoURL || gigData?.sellerPhoto || '';
        sellerName.textContent = u.fullName || u.displayName || gigData?.sellerName || 'Seller';
        sellerBio.textContent = u.bio || gigData?.sellerBio || '';
        sellerSince.textContent = u.since ? '• Since ' + u.since : (gigData?.sellerSince ? '• Since ' + gigData.sellerSince : '');
        sellerProfileLink.href = `seller.html?id=${s.id}`;
      }, err => { console.warn('seller listen err', err); });
    }

    // -------------------- Contact & Continue --------------------
    contactBtn.addEventListener('click', ()=>{
      if (!gigData) return alert('Not loaded yet');
      const sellerId = gigData.createdByUid || gigData.sellerId || gigData.createdByUid || '';
      if (!sellerId) return alert('Contact not available');
      // if sellerId looks like an email open mailto
      if (sellerId.includes('@')) window.location = `mailto:${encodeURIComponent(sellerId)}?subject=${encodeURIComponent('Inquiry about: '+(gigData.title||'Gig'))}`;
      else window.location = `client-messages.html?to=${encodeURIComponent(sellerId)}`;
    });

    continueBtn.addEventListener('click', ()=>{
      if (!currentUser) {
        if (confirm('Login required to continue. Go to login?')) window.location='login.html';
        return;
      }
      window.location = `continue.html?id=${GIG_ID}&col=${GIGS_COL}`;
    });

    // -------------------- Tabs behaviour --------------------
    $$('.tab').forEach(t=>{
      t.addEventListener('click', ()=> {
        $$('.tab').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
        const tab = t.dataset.tab;
        $('#detailsTab').classList.toggle('hidden', tab!=='details');
        $('#reviewsTab').classList.toggle('hidden', tab!=='reviews');
        $('#faqTab').classList.toggle('hidden', tab!=='faq');
        $('#similarTab').classList.toggle('hidden', tab!=='similar');
      });
    });

    // -------------------- Auth state --------------------
    onAuthStateChanged(auth, user=>{
      currentUser = user;
      loginStatus.textContent = user ? `Logged in: ${user.displayName || user.email || user.uid}` : 'Not logged in';
      refreshUserLikeState();
    });

    // small safety: load reviews initially
    subscribeReviews();

  </script>
</body>
</html>
